{% set all_post_articles = all_post_articles %}
{% set all_posts = all_posts %}
{% set categories = categories %}
{% set is_direct_link = is_direct_link|default(false) %}
{% set current_category = current_category|default('all') %}

<section class="relative" data-component="newsroomAjaxFilter">
    <div class="site-max site-grid pt-80 s:pt-0 pb-32 s:pb-160">
        <div class="s:col-start-1 col-span-full s:col-span-6 pb-65 s:pb-0">
            <h2 class="font-sans text-40 font-normal leading-[1.15] tracking-[-1%] text-green">{{ all_post_articles.title }}</h2>
        </div>

        <div class="relative s:col-start-9 col-span-full s:col-span-8 flex justify-end">
            <div class="relative pr-150 s:pr-0 overflow-x-auto s:overflow-x-visible scrollbar-hide flex items-start s:items-center justify-start s:justify-center flex-nowrap s:flex-wrap">
                {# "All" button - set active based on current category #}
                <button class="hover:bg-white-smoke transition-colors duration-300 relative whitespace-nowrap s:whitespace-normal py-16 px-24 font-sans text-12 font-medium leading-none tracking-[0.12rem] uppercase border-[0.1rem] border-solid border-grey-taupe {{ current_category == 'all' ? 'bg-white-smoke pointer-events-none select-none' }}" 
                    type="button" 
                    aria-label="Button to filter by all" 
                    data-filter="all">All</button>
            
                {# Category buttons - set active based on current category #}
                {% for category in categories %}
                    <button class="hover:bg-white-smoke transition-colors duration-300 relative whitespace-nowrap s:whitespace-normal py-16 px-24 font-sans text-12 font-medium leading-none tracking-[0.12rem] uppercase border-[0.1rem] border-solid border-grey-taupe ml-[-1px] {{ current_category == category.slug ? 'bg-white-smoke pointer-events-none select-none' }}" 
                            type="button" 
                            aria-label="Button to filter by {{ category.name }}" 
                            data-filter="{{ category.slug }}">{{ category.name }}</button>
                {% endfor %}
            </div>

            <div class="newsroom-gradient select-none pointer-events-none absolute top-0 -right-20 w-[15rem] h-full block s:hidden"></div>
            
            <div class="absolute top-1/2 -translate-y-1/2 -right-10 block s:hidden select-none pointer-events-none">
                <button class="relative pointer-events-auto flex items-center justify-center bg-white-smoke p-8 rounded-[0.4rem]" type="button" aria-label="Button to scroll the filters">
                    <svg class="w-[0.7rem] h-auto" viewBox="0 0 7 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.57813 1L6.07813 5.5L1.57812 10" stroke="#1E383E" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="col-start-1 col-span-full pt-30 s:pt-50 flex flex-col gap-25 js-newsroom-container">
            {# Posts container - loads server-side initially, then via AJAX #}
            <div class="js-newsroom-posts">
                {% if is_direct_link %}
                    {# For direct links, show loading state and let JavaScript handle it #}
                    <div class="loading-placeholder text-center py-8">
                        <div class="animate-pulse">
                            <p class="text-gray-600">Loading posts...</p>
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {% for i in 1..6 %}
                                    <div class="bg-gray-200 h-48 rounded"></div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% else %}
                    {# Default state - show server-side posts #}
                    {% if all_posts and all_posts|length > 0 %}
                        <div class="news-grid-blog-page">
                            {% for post in all_posts %}
                                {% include 'partials/newsroom-post-item.twig' with { post: post } %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-posts">
                            <p class="text-center text-gray-600">No posts found.</p>
                        </div>
                    {% endif %}
                {% endif %}
            </div>

            {# Pagination container - will be populated via AJAX for direct links #}
            <div class="js-newsroom-pagination">
                {% if not is_direct_link and all_posts.pagination is defined and all_posts.pagination.pages is not empty %}
                    {% include 'partials/pagination.twig' with {
                        props: {
                            pagination: all_posts.pagination,
                            items_per_page: 12,
                            items_per_page_options: [6, 12, 18]
                        }
                    } %}
                {% endif %}
            </div>
        </div>
    </div>
</section>